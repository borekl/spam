date         component      description
===========  =============  ================================================

--- 2005 -------------------------------------------------------------------

24-Aug-2005  spam.pl        cfg_switch_list_load() now loads only switches
                            with "spam" flag set in monitor field of monitor
                            table

25-Aug-2005  SPAM_SNMP.pm   Fixed getting module info on Cat6K IOS switches

29-Aug-2005  spam.pl        Fixed problem where module name/serial was not
                            displayed on TenGigabitEthernet modules

29-Aug-2005  spam.pl        Rewritten function compare_ports(); no idea
                            why it was so complicated before

30-Aug-2005  SPAM.pm        Function sql_outlet_sites() was generalized into
             spam.cgi       sql_sites() with db table as argument; the table
                            must have 'site' column

30-Aug-2005  spam.cgi       "Patch Panel Map Tool" added along with new table
                            'ppmap' in backend db

 9-Sep-2005  SPAM.PM        New configuration command "SQLquery" for externa-
             spam.pl        lizing static SQL query statements

13-Sep-2005  SPAM_SNMP.pm   Cat4K IOS switches module model and S/N reporting
             spam.pl        now works (FIXME: No, it doesn't work correctly:
                            as there is a list of modules without module slot
                            numbers in SNMP!)

20-Sep-2005  spam.cgi       New column "network" added to Search Tool which
                            shows IP network associated with configured VLAN.
                            This is implemented by creating temporary table
                            in spam db, which is filled with data from ondb
                            database and then used in main query.

12-Oct-2005  SPAM.pm        period() now omits minutes if the period is 
                            1000 days or larger

27-Oct-2005  SPAM.pm        External commands snmpwalk and snmpget are 
             SPAM_SNMP.pm   now defined in configuration file instead of
             spam.pl        being hard-wired in SPAM_SNMP.pm

--- 2006 -------------------------------------------------------------------

01-Feb-2006  spam-swbug.pl  New component, sends e-mail reports on inactive
                            and unregistered switch ports.

01-Feb-2006  spam.cgi       In form_add(), cp value of 'undef' is not
                            checked for uniqueness (implemented for
                            direct interconnects).

24-Feb-2006  spam.cgi       In sql_find_port there was error in phase 2:
                            the regexp used to search for port in db
                            must have terminating '$' anchor; this bug
                            lead to invalid port name expansion (eg.
                            "8/2" to "Gi8/22"

28-Feb-2006  db-schema      Added column "grpid" to table "hosttab"

01-Feb-2006  spam.cgi       Basic infrastructure for deriving access
                            rights from userdb added: function
                            user_access evaluate(USERID, ACCESS);
                            also userid and associated group is displayed
                            on WWW pages generated by the spam.cgi

12-Apr-2006  spam.cgi       Development version deployed; number of other
                            changes, mainly related to authorization via
                            userdb.

20-Apr-2006  db-schema      Column 'descr' added to status table.
             spam.pl        

28-Apr-2006  spam.pl        spam.pl now takes two more command-line options:
                            --arpservers and --hosts. They force SPAM to
                            list its configured list of ARP servers or 
                            switches and exit.

02-May-2006  spam.pl        Sorting order for ports now has two modes: one
                            for multi-module switches (C6000 and C4000
                            series) and other for small switches (C2900 and
                            C3500 series). This makes sorting order in
                            port lists to be in expected order - Fa and Gi
                            ports are no longer mixed together on small
                            switches. Functions compare_ports() and
                            html_portlist_by_host() were modified.

11-May-2006  spam.pl        Added suport for Cisco 2620 router since we
                            use it with NM-16ESW in place of separate
                            switch. Caveat: Both routed and switched ports
                            appear in port lists.

24-May-2006  spam.pl        BUGFIX: fixed a bug that caused, that inactivity
                            period was not visible on port list (internally,
                            the bug also caused unnecessary full update in
                            "status" table for ports even when their status
                            was not changed)

31-May-2006  db-schema      New table 'permout' listing "permanent" outlets;
             SPAM.pm        load_outlet_tables in SPAM.pm update to read
             spam.cgi       'dont_age' flag from 'permout' table; added GUI
                            to manage 'permout' table; modified
                            'html_query_out' function: improved parsing of
                            arguments; new 'o' option of "OID marking" (ie.
                            visually highlighting rows by its OID number.

13-Jun-2006  spam.pl        BUGFIX: One of the conditions that determined
                            whether a switch port is active was changed from
                            "operational status changed" to "operational
                            status is up". This fixes problem with ports
                            that were operationally up, but had no rx/tx
                            traffic (inactivity period was shown for such
                            ports)

26-Jun-2006  SPAM.pm        REMOVED: 'fault' flag is no longer handled
                            in load_outlets() as this feature was never
                            really used; the appropriate column in out2cp is
                            slated for removal along with 'dont_age' (which
                            now resides in separate table).

26-Jun-2006  SPAM.pm        Function load_hosttab() added to SPAM.pm which
             spam.pl        loads contents of 'hosttab' table into memory

28-Jun-2006  SPAM.pm        Keyword 'SiteConv' now recognized in spam.cfg;
                            this is used by new function site_conv() to
                            convert from hostname to site code (such as
                            vdcS02c -> vin)

28-Jun-2006  spam.pl        NEW FEATURE: Column 'location' was removed from
                            port listing and was replaced by 'host' and 
                            'group' (data come from 'hosttab' table). 'host'
                            is server name associated with outlet/cp; 'group'
                            is responsible group (such as 'netit', 'unix'
                            etc.)

 3-Jul-2006  db-schema      Added table 'prodstat' to enumerate production
                            states of a server ('testing', 'development',
                            'production').
                            Added 'prodstat' to 'hosttab' table; this field
                            will contain 'prod', 'test' or 'deve' indicating
                            usage status of a server; 

 3-Jul-2006  spam.cgi       Seconds trimmed from creat_when and chg_when
                            fields in "Host remove/update" to spare some 
                            room for new field.

 7-Jul-2006  spam.cgi       NEW FEATURE: Production status field has been
                            added to "Add host" and "Remove/update host"
                            forms.
                            + html_query_out() now takes another option 'h'
                            which is used to hide column from its output.
                            + sql_get_table_hash() added, used for loading
                            table into hash.

17-Aug-2006  spam.pl        Catalyst 4948 added as a supported platform.

18-Aug-2006  SPAM.pm        BUGFIX: Permanent outlets were not marked
                            in portslist due to a bug; fixed.

18-Aug-2006  spam.pl        Ports receiving CDP packets are not marked
                            as 'unregistered' even if they don't have
                            associated entry in 'porttable'. This obviates
                            need for putting cp = undef on directly
                            interconnected ports in many cases. See also
                            change of 1-Feb-2006.

23-Aug-2006  spam.pl        Port duplex is now read using Etherlike-MIB
                            (variable dot3StatsDuplexStatus) for all
                            "big" switches running IOS; this means that
                            duplex status for ports on multislot IOS
                            switches is now correctly displayed in port
                            list.

23-Aug-2006  db-schema      Added columns to status: duplex, rate, flags.
                            Created new table: sflags.

13-Sep-2006  spam.pl        ifAlias is used for all but CatOS switches to
                            get port descriptions; also portName values
                            are moved to ifAlias tree and portName is then
                            deleted

14-Sep-2006  db-schema      Table 'modstat' to supplement 'status' table
             spam.pl        and hold information about switch modules.
                            The code to maintain this table was added
                            to the collector as sql_modstat_update()
                            function.

10-Oct-2006  spam.pl        'up' ports never show inactivity period, even
                            if there is one; newly discovered ports should
                            now follow this rule as well

 7-Nov-2006  db-schema      New table 'mactable2'; used by expanded
             spam.pl        sql_mactable_update() function, which now
                            has following additional functionality:
                            when entry in 'mactable' is updated,
                            then the entry is copied into 'mactable2'
                            in its state BEFORE the update in 'mactable';
                            this will facilitate keeping track of MAC
                            addresses on dual-connected systems; GUI
                            for this function will be written later

30-Nov-2006  spam.pl        BUGFIX: Changing of interface description
                            on a switch did not propagate to 'status'
                            table (confused 'ne' operator with '!=')

--- 2007 -------------------------------------------------------------------

12-Jan-2007  spam-swbug.pl  Ports that receive CDP packets are not
                            announced as unregistered (simple query
                            modification)

12-Jan-2007  view.cgi       "down-unpatched" state for ports recognized
                            now; in port listings is present as grey
                            port names (instead of red ones)

22-Jan-2007  spam-swbug.pl  Cp's listed in 'permout' table are not
                            announced as inactive (simple query
                            modification)

23-Jan-2007  spam.pl        Platform "c2960" introduced.

23-Jan-2007  view.cgi       Ports that are operationally up never
                            show inactivity period -- even if there is
                            one

23-Jan-2007  spam.pl        All HTML generating code was removed
                            except code generating VLAN list. This
                            function has already been reimplemented
                            by view.cgi; spam.pl is now 16 KB smaller

31-May-2007  spam.pl        SPAM now retrieves from switches not only
             view.cgi       information about modules (linecards) but
             SPAM_SNMP.pm   also about chassis and power supplies.
             db-schema      The retrieval function was rewritten to
                            properly use ENTITY-MIB and is universal
                            across most system images (CatOS and IOS).
                            Some SUP-1A images don't properly support
                            ENTITY-MIB; in such cases SPAM will
                            automatically detect this and fall back
                            to old ways. The new information is stored
                            in table 'hwinfo', which obsoletes
                            previously used 'modstat' table.

21-Jun-2007 spam.pl         New field 'boot_time' in table 'swstat';
            SPAM_SNMP.pm    contains time the switch booted; intended
            db-schema       for reboot detection.

21-Jun-2007 spam.pl         NEW FEATURE: SPAM now should detect
                            when switch reboots and resets all its
                            counters; now the inactivity period for ports
                            should be able to go undisrupted by those
                            reboots. UNTESTED YET!

22-Jun-2007 spam.cgi        In search tool the 'site' pop-up menu
                            contains value '-any-', which allows
                            to search all sites at once.

22-Jun-2007 SPAM_SNMP.pm    When reading list of MACs from switch, all
                            MACs that are not in 'learned' state are
                            discarded; this gets rid of switch's own
                            MAC addresses showing in SPAM database.

 3-Jul-2007 view.cgi        Cost analysis views were added. Authorization
                            token 'cost' is necessary to be able to access
                            them.

 3-Jul-2007 spam.cgi        After entering new patches vi "Add Patches"
                            form there is now "Update summary" which
                            contains port, cp, outlet and vlan for each
                            port successfully inserted into database.

 4-Jul-2007 view.cgi        Redundancy checking for hosts implemented.

--- 2008 -------------------------------------------------------------------

 3-Jan-2008 spam.pl         Queries configured by 'sqlquery' configuration
                            statement were converted to SQL views.
                            'sqlquery' was removed.

 3-Jan-2008 spam.pl         "Unreg" field was always zero in Switch List.
                            Fixed.

 3-Jan-2008 view.cgi        In "Port List" extra information is shown.

 4-Jan-2008 spam.pl         Port descriptions can now contain apostrophe(s)
                            (lack of quoting caused failed database updates)

 4-Jan-2008 spam.pl         Another way of learning about STP Fast Start
            SPAM_SNMP.pm    mode on ports implemented as CISCO-STACK-MIB
                            seems to be phased-out on newer IOS releases.
                            The new way uses CISCO-STP-EXTENSION-MIB and
                            works on most new IOS versions. The old way
                            is obsolete and will eventually be removed.

15-Apr-2008 spam.cgi        New features: PBX database maintenance

15-Apr-2008 SPAM_SNMP.pm    snmp_mac_table(): Each discovered MAC is only
                            stored once in results; subsequent occurences
                            are ignored (it shouldn't be possible, but
                            in reality it is).

12-Nov-2008 spam.pl         Some newer supervisors did not wrap their
                            packet counters at 2^31 boundary. This caused
                            %ld in (s)printf to start returning negative
                            values and this resulted in lastchg time
                            to be constantly updated, causing the inactivity
                            time not to be calculated and displayed.
                            Fixed with switching to %lu in (s)printf's.

--- 2009 -------------------------------------------------------------------

21-Apr-2009 spam.cgi        Improved generation of search SQL query
                            (function sql_query()); there were problems
                            when searching MAC/IP addresses that were on
                            ports not present in porttable

22-Apr-2009 view.cgi        In "Switch List" view there is menu for 
            swlistmnu.js    switching between different groups of switches
                            to facilitate easier navigation. Written in
                            JavaScript with jQuery, uses swlistmnu.js file.
                            If JavaScript is switched off in browser,
                            the behaviour is the same as before.

18-May-2009 view.cgi        "Last check" time is displayed in Port List.

20-May-2009 spam.pl         Lock file is not created when --arpservers or
                            --host command line options are used.

 5-Jun-2009 spam.pl         Fixed a bug in poll_host() that caused premature
                            exit from the loop in main; caused by "next"
                            statement in poll_host().

19-Jun-2009 spam.cgi        "Add new patch(es)" now allows site selection on
                            first line only and that is used for all form
                            rows; also, the site is now stored in cookie
                            and thus remembered across sessions (most users
                            only use one value).

19-Jun-2009 spam.cgi        "Patch Panel Map Tool" now remembers site using
                            cookie.

25-Jun-2009 spam.cgi        More optimization of sql_query() to improve
                            results.

10-Aug-2009 ppmap.js        Visual display of patch panel map added as an
            ppmap.cgi       extra feature; uses AJAX+HTML Canvas. ppmap.js
            spam.cgi        is the client-side script; ppmap.cgi is server-
                            side program sitting between SQL database and
                            the client-side script.

10-Aug-2009 db-schema       ppmap new field "room" to enable multiple patch
                            panels per site.

17-Aug-2009 ppmap.cgi       Patch panel map updated to work with site-room
                            as primary key instead of site only.

--- 2010 -------------------------------------------------------------------

16-Feb-2010 spam.cgi        New authorization token 'debug' is now
                            recognized and sets global variable $debug in
                            the CGI; 'debug' is not included in 'all' token
                            and needs to be turned on separately

25-Mar-2010 spam.cgi        Stored procedure in database "ondb"
            db-schema       authorize_user(user,system,token) now
            SPAMv2.pm       encapsulates checking whether user is authorized

 8-Apr-2010 ppmap.js        The data between ppmap.cgi (back-end) and       
            ppmap.cgi       ppmap.js (client-side) are now passed as
                            CSV-like text instead of XML. This makes
                            client-side processing significantly faster.

13-Jul-2010 view.cgi        compare_ports() reimplemented to allow for VSS
            SPAMv2.pm       port names and moved from view.cgi to SPAMv2.pm

29-Jul-2010 view.cgi        validate_port() and sql_find_port() modified to
                            accomodate VSS switches ports in form x/y/z.

12-Aug-2010 view.cgi        switches not polled for more than 30 days marked
                            with a red exclamation mark in Switch List

13-Aug-2010 SPAM.pm         Updated names of SPAM.pm function with v1_
            spam.pl         prefix in preparation of migration to DBI 
            spam.cgi        interface version.
            spam-swbug.pl

16-Aug-2010 SPAM.pm         All SQL-using function were moved from SPAM.pm
            SPAMv2.pm       to SPAMv2 except dbinit, dbconn and dbdone.
            spam.pl         This enables gradual migration from Pg to DBI
            spam.cgi        database API.

20-Aug-2010 spam.pl         Collector now fully converted to DBI, SPAMv2.pm.

--- 2011 -------------------------------------------------------------------

 1-Mar-2011 spam.cgi        CGI GUI fronted now fully converted to DBI,
                            SPAMv2.pm

 4-Apr-2011 spam.cgi        Add Patches and Add Hosts forms now have JS
                            powered controls for adding/removing rows
                            (code in spam-form_add.js).

 8-Apr-2011 spam.pl         Option --host now accepts partial matches
                            anchored on string beginning (ie. --host=vin
                            will match all switches beginning with 'vin')

15-Apr-2011 spam.pl         List of switches to be processed is now
                            prepared into @work_list before the actual
                            processing begins (preparation for parallel
                            execution).

22-Apr-2011 spam.pl         Collector now collects data from switches
                            in fork()-ed section, allowing for multiple
                            concurrent instances to be run, greatly
                            speeding up the collection. New --tasks
                            option specifies how many concurrent processes
                            to run (default is 8). --vlanlist and
                            --arplists are no longer default on.

27-Apr-2011 spam.cgi        Add Patches improvement; when there's conflict
                            in switchport or cp/outlet during adding, 
                            the error message contains link to Remove Tool
                            prefilled with conflicting record's data.

28-Apr-2011 -backend.cgi    ppmap.cgi renamed to spam-backend.cgi; data
                            passed between client and backend are now
                            encoded as JSON.; created new view v_ppmap
                            that supplies data to the backend

17-Aug-2011 view.cgi        In "Switch List" there is one more switch group
            swlistmnu.js    marked with red "!", that contains stale
                            switches. This only appears for users with
                            'debug' token.

30-Aug-2011 spam.pl         Used and Unused ports now shown in switch list
            view.cgi        page; "used" port is that, which has seen
                            activity in last 30 days.

--- 2012 -------------------------------------------------------------------

 3-Sep-2012 spam.pl         In support of 802.1x roll-out, additional flag
            view.cgi        is now displayed in Port List showing dot1x
                            status information

--- 2013 -------------------------------------------------------------------

10-May-2013 spam.pl         --arpservers statement did nothing, fixed

--- 2014 -------------------------------------------------------------------

15-Apr-2014 SPAM_SNMP.pl    On ports with authentication (802.1x etc.) MACs
                            are listed as static, those weren't collected
                            by SPAM, fixed.

16-Apr-2014 SPAM_SNMP.pl    There was gross inefficiency in snmp_mac_table()
                            that cause getting MACs from switches to last
                            very long time. The whole run of all switches
                            went from 72 min. down to less than 6 min.
