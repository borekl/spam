<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<HTML>

<HEAD>
  <TITLE>About SPAM</TITLE>
  <META HTTP-EQUIV="Content-type" CONTENT="text/html; charset=utf-8">
  <LINK REL=STYLESHEET TYPE="text/css" HREF="../default.css">
  <LINK REL=STYLESHEET TYPE="text/css" HREF="about.css">
</HEAD>

<BODY LANG="en">

<H1>About Switch Ports Activity Monitor</H1>

<DIV>
<P CLASS="std">Switch Ports Activity Monitor (SPAM) is a network monitoring
tool that handles monitoring and maintaining switched Ethernet network. This page
ought to document all aspects of SPAM.</P>
<P CLASS="std">SPAM's main tasks are following:</P>

<UL CLASS="frlist">
  <LI>Monitors state of individual ports on all switches
  <LI>Records inactivity on ports to facilitate discovery of ports no longer in use
  <LI>Captures the state of patchwork in wiring closets
  <LI>Provides WWW interface for administrating the patch database
  <LI>Provides search functions with WWW interface
  <LI>Provides summary of network outlets usage
</UL>

<P CLASS="std">SPAM consists of several components:</P>

<UL CLASS="frlist">
  <LI><A HREF="#backenddb">Backend database</A> stores operational data
  <LI><A HREF="#collector">Collector</A> periodically polls network devices for status data
  <LI><A HREF="#wwwif">WWW interface</A> allows to perform searches and administration
  <LI><A HREF="#misc">Miscellaneous scripts</A>, that perform maintenance or allow to access additional information
</UL>
</DIV>

<HR>

<A NAME="backenddb">
<H2>Backend Database</H2>
</A>

<DIV>
<P CLASS="std">SPAM uses <A HREF="http://www.postgresql.org">PostgreSQL</A> database
server to store and retrieve status information
it receives from its collector component and the information that is entered to
it using the administration interface. There are several tables being
used:</P>


<DL>
  <DT><TT><B><A HREF="tables.html#tbl_status">status</A></B></TT>
  <DD>This table stores transient information collected from monitored switches
      over SNMP by collector component. One row in this table corresponds to
      one switch port.
  <DT><TT><B><A HREF="tables.html#tbl_porttable">porttable</A></B></TT>
  <DD>This is administrator-maintained table that captures the patchwork between
      outlets and switch ports. In this way every outlet that is activated using a
      patch cord connecting it to a port switch results in a row in this table.
  <DT><TT><B><A HREF="tables.html#tbl_out2cp">out2cp</A></B></TT>
  <DD>This rather static table maps outlet numbers to the consolidation port
      counterpart. This usually changes only when new outlets are added.
  <DT><TT><B><A HREF="tables.html#tbl_mactable">mactable</A></B></TT>
  <DD>This additional table is created by the collector and contains lists of
      MAC addresses discovered on each switch port.
  <DT><TT><B>arptable</B></TT>
  <DD>Additional table that holds MAC address to IP address mapping and is
      retrieved from defined core routers.
  <DT><TT><B><A HREF="tables.html#tbl_cpranges">cpranges</A></B></TT>
  <DD>Auxiliary table that tells what consolidation point is present at what switch.
  <DT><TT><B><A HREF="tables.html#tbl_oui">oui</A></B></TT>
  <DD>Auxiliary table that maps first three bytes of a MAC address to a NIC vendor
      name.
  <DT><TT><B>swstat</B></TT>
  <DD>Internal table in which switch summary statistics are stored. It is
      used when regenrating switch list page.

</DL>
</DIV>

<HR>

<A NAME="collector">
<H2>Collector (<EM>swports.pl</EM>)</H2>
</A>

<DIV>
<P CLASS="std">Collector is a script written in Perl, that gathers status information about ports
from switches via SNMP. The retrieved data are written to table <TT>status</TT> in
SQL database. The collector retrieves port status (up/down), duplex status, speed,
VLAN number, bridging information and in/out bytes counter. After the collection of
status data is done, it generates series of HTML pages—one for each switch and
VLAN—that list all ports along with relevant information about their status.
The collector is run on regular basis from cron. It uses file
<TT>/tmp/spam.lock</TT> to avoid multiple instances running at the same
time.</P>
</DIV>

<H3>Command line options</H3>

<DIV>

<DL>

<DT CLASS="statement">--noreport
<DD>this option turns off generating HTML pages

<DT CLASS="statement">--noarptable
<DD>this option turns off retrieval of ARP table from defined core routers

<DT CLASS="statement">--nomactable
<DD>this option turns off retrieval of dot1d bridging table switches and
updating appropriate table in backend database

<DT CLASS="statement">--host=<SPAN CLASS="nt">host</SPAN>
<DD>this option constrains polling to only <I>host</I>; this option can be
used more than once for polling just a few hosts

<DT CLASS="statement">--maint
<DD>this option invokes backend database maintenance, which includes
purging stale entries from <TT>mactable</TT> and <TT>arptable</TT>

<DT CLASS="statement">--help, -?
<DD>this option causes the SPAM collector to write out brief help and then
exit without any further action

</DL>

</DIV>

<H3>Configuration file</H3>

<DIV>

<P CLASS="std">SPAM collector reads configuration file <TT>spam.cfg</TT> in
its current directory. The configuration is plain text file with following
configuration statements.</P>

<DL>

<DT CLASS="statement">htmldir <SPAN CLASS="nt">path</SPAN>
<DD>This statement defines where the HTML pages will be generated

<DT CLASS="statement">inactivethreshold <SPAN CLASS="nt">seconds</SPAN>
<DD>Ports showing no activity for this long will be marked as inactive

<DT CLASS="statement">inactivethreshold2 <SPAN CLASS="nt">seconds</SPAN>
<DD>Ports showing no activity for this long will be marked as long time inactive

<DT CLASS="statement">excludehost <SPAN CLASS="nt">hostname</SPAN>
<DD>Force not processing of this host

<DT CLASS="statement">patchmap <SPAN CLASS="nt">hostname</SPAN>
<DD>Include patch panel map with ports listing

<DT CLASS="statement">knownports <SPAN CLASS="nt">hostname</SPAN>
<DD>This will turn on special processing of registered ports (ie. ports that
are in table "porttable" in backend database); for these switches ports,
that are inactive will be either grayed out (if they are unregistered) or
marked inactive; also when port is found active and it is unregistered, it
will generate a warning

<DT CLASS="statement">arpserver <SPAN CLASS="nt">hostname</SPAN>
<DD>This command defines host(s) that will be queried for their ARP tables;
SPAM stores ARP tables to map MACs to IPs which enables users to search by
IP addresses; use this command several times to include more than one router

<DT CLASS="statement">community <SPAN CLASS="nt">community-string</SPAN>
<DD>This command defines SNMP community string to be used to poll hosts and
retrieve ARP table from routers

<DT CLASS="statement">dbconn <SPAN CLASS="nt">id</SPAN>
<SPAN CLASS="nt">user</SPAN>/<SPAN CLASS="nt">password</SPAN>:<SPAN CLASS="nt">database</SPAN>[@<SPAN CLASS="nt">host</SPAN>]
<DD>This statement defines backend database connection parameters; host
definition is optional—when none is supplied localhost is used; currently
two id's must be defined for SPAM: <B>spam</B>, which connects the collector to
its native backend database; and <B>oskarnet</B> which is used to get list of
switches from the Oskar Network Database.


</DL>

</DIV>

<HR>

<A NAME="wwwif">
<H2>WWW Interface (<EM>swports.cgi</EM>)</H2>
</A>

<DIV>
<P CLASS="std">WWW interface is designed for maintaining the outlet-to-port database, ie. table
<TT>porttable</TT>. It provides forms for adding, removing and finding information
from the SQL database. This WWW front-end is available to technicians who perform
the actual patching in wiring closets.</P>
</DIV>

<HR>

<A NAME="misc">
<H2>Miscellaneous</H2>
</A>

<DIV>
<P CLASS="std">There are few more less important supporting scripts. These are:</P>
<DL>
  <DT><B>report.cgi</B>
  <DD>Gives overall statistics on outlets usage calculated from current data in
      database.
  <DT><B>portinfo.cgi</B>
  <DD>Gives list of MAC addresses found on one particular port.
  <DT><B>vacuum.pl</B>
  <DD>Does regular database maintenance; runs Postgres's <TT>VACUUM</TT> command and deletes
      stale entries from tables <TT>status</TT> and <TT>mactable</TT>.
</DL>
</DIV>

</BODY>

</HTML>
